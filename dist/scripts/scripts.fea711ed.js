function LineStatusService(){}var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;l>c;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(){{var a={exports:{}};a.exports,require("ender")}!function(){"use strict";function b(a){var b,c=new Uint8Array(a);for(b=0;a>b;b+=1)c[b]=0;return c}function c(a,c,d,e){var f=c+d,g=b((parseInt(f/e)+1)*e);return g.set(a),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(a,c,d){var e,f;for(c=c||b(a.length),d=d||0,e=0,f=a.length;f>e;e+=1)c[d]=a.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;e>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];a.exports.clean=b,a.exports.pad=d,a.exports.extend=c,a.exports.stringToUint8=e,a.exports.uint8ToBase64=f}(),provide("tar-js/utils",a.exports)}(global),function(){{var a={exports:{}};a.exports,require("ender")}!function(){"use strict";function b(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;d>c;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],a.exports.structure=c,a.exports.format=b}(),provide("tar-js/header",a.exports)}(global),function(){{var a={exports:{}};a.exports,require("ender")}!function(){"use strict";function b(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;b.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;c>b;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\x00 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},b.prototype.clear=function(){this.written=0,this.out=e.clean(c)},a.exports=b}(),provide("tar-js",a.exports)}(global),function(){"use strict";function a(){this._events=this._events||{}}function b(c){var d=this;if(!(this instanceof b))return new b(arguments[0],arguments[1],arguments[2]);a.call(this),"number"==typeof c&&(c={cols:arguments[0],rows:arguments[1],handler:arguments[2]}),c=c||{},k(l(b.defaults),function(a){null==c[a]&&(c[a]=b.options[a],b[a]!==b.defaults[a]&&(c[a]=b[a])),d[a]=c[a]}),8===c.colors.length?c.colors=c.colors.concat(b._colors.slice(8)):16===c.colors.length?c.colors=c.colors.concat(b._colors.slice(16)):10===c.colors.length?c.colors=c.colors.slice(0,-2).concat(b._colors.slice(8,-2),c.colors.slice(-2)):18===c.colors.length&&(c.colors=c.colors.concat(b._colors.slice(16,-2),c.colors.slice(-2))),this.colors=c.colors,this.options=c,this.parent=c.body||c.parent||(m?m.getElementsByTagName("body")[0]:null),this.cols=c.cols||c.geometry[0],this.rows=c.rows||c.geometry[1],c.handler&&this.on("data",c.handler),this.ybase=0,this.ydisp=0,this.x=0,this.y=0,this.cursorState=0,this.cursorHidden=!1,this.convertEol,this.state=0,this.queue="",this.scrollTop=0,this.scrollBottom=this.rows-1,this.applicationKeypad=!1,this.applicationCursor=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!1,this.normal=null,this.prefixMode=!1,this.selectMode=!1,this.visualMode=!1,this.searchMode=!1,this.searchDown,this.entry="",this.entryPrefix="Search: ",this._real,this._selected,this._textarea,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.decLocator,this.x10Mouse,this.vt200Mouse,this.vt300Mouse,this.normalMouse,this.mouseEvents,this.sendFocus,this.utfMouse,this.sgrMouse,this.urxvtMouse,this.element,this.children,this.refreshStart,this.refreshEnd,this.savedX,this.savedY,this.savedCols,this.readable=!0,this.writable=!0,this.defAttr=131840,this.curAttr=this.defAttr,this.params=[],this.currentParam=0,this.prefix="",this.postfix="",this.lines=[];for(var e=this.rows;e--;)this.lines.push(this.blankLine());this.tabs,this.setupStops()}function c(a,b,c,d){a.addEventListener(b,c,d||!1)}function d(a,b,c,d){a.removeEventListener(b,c,d||!1)}function e(a){return a.preventDefault&&a.preventDefault(),a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,!1}function f(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function g(a){var b=a.getElementsByTagName("body")[0],c=a.createElement("span");c.innerHTML="hello world",b.appendChild(c);var d=c.scrollWidth;c.style.fontWeight="bold";var e=c.scrollWidth;return b.removeChild(c),d!==e}function h(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function i(a){return"＀">=a?!1:a>="！"&&"ﾾ">=a||a>="ￂ"&&"ￇ">=a||a>="ￊ"&&"ￏ">=a||a>="ￒ"&&"ￗ">=a||a>="ￚ"&&"ￜ">=a||a>="￠"&&"￦">=a||a>="￨"&&"￮">=a}function j(a,c,d){var e=a<<16|c<<8|d;if(null!=j._cache[e])return j._cache[e];for(var f,g,h,i,k,l=1/0,m=-1,n=0;n<b.vcolors.length;n++){if(f=b.vcolors[n],g=f[0],h=f[1],i=f[2],k=j.distance(a,c,d,g,h,i),0===k){m=n;break}l>k&&(l=k,m=n)}return j._cache[e]=m}function k(a,b,c){if(a.forEach)return a.forEach(b,c);for(var d=0;d<a.length;d++)b.call(c,a[d],d,a)}function l(a){if(Object.keys)return Object.keys(a);var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}var m=this.document;a.prototype.addListener=function(a,b){this._events[a]=this._events[a]||[],this._events[a].push(b)},a.prototype.on=a.prototype.addListener,a.prototype.removeListener=function(a,b){if(this._events[a])for(var c=this._events[a],d=c.length;d--;)if(c[d]===b||c[d].listener===b)return void c.splice(d,1)},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(a){this._events[a]&&delete this._events[a]},a.prototype.once=function(a,b){function c(){var d=Array.prototype.slice.call(arguments);return this.removeListener(a,c),b.apply(this,d)}return c.listener=b,this.on(a,c)},a.prototype.emit=function(a){if(this._events[a])for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=c.length,e=0;d>e;e++)c[e].apply(this,b)},a.prototype.listeners=function(a){return this._events[a]=this._events[a]||[]};var n=0,o=1,p=2,q=3,r=4,s=5,t=6;f(b,a),b.prototype.eraseAttr=function(){return-512&this.defAttr|511&this.curAttr},b.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"],b.xtermColors=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"],b.colors=function(){function a(a,b,d){e.push("#"+c(a)+c(b)+c(d))}function c(a){return a=a.toString(16),a.length<2?"0"+a:a}var d,e=b.tangoColors.slice(),f=[0,95,135,175,215,255];for(d=0;216>d;d++)a(f[d/36%6|0],f[d/6%6|0],f[d%6]);for(d=0;24>d;d++)f=8+10*d,a(f,f,f);return e}(),b.colors[256]="#000000",b.colors[257]="#f0f0f0",b._colors=b.colors.slice(),b.vcolors=function(){for(var a,c=[],d=b.colors,e=0;256>e;e++)a=parseInt(d[e].substring(1),16),c.push([a>>16&255,a>>8&255,255&a]);return c}(),b.defaults={colors:b.colors,convertEol:!1,termName:"xterm",geometry:[80,24],cursorBlink:!0,visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,useStyle:!1},b.options={},k(l(b.defaults),function(a){b[a]=b.defaults[a],b.options[a]=b.defaults[a]}),b.focus=null,b.prototype.focus=function(){b.focus!==this&&(b.focus&&b.focus.blur(),this.sendFocus&&this.send("[I"),this.showCursor(),b.focus=this)},b.prototype.blur=function(){b.focus===this&&(this.cursorState=0,this.refresh(this.y,this.y),this.sendFocus&&this.send("[O"),b.focus=null)},b.prototype.initGlobal=function(){var a=this.document;b._boundDocs=b._boundDocs||[],~h(b._boundDocs,a)||(b._boundDocs.push(a),b.bindPaste(a),b.bindKeys(a),b.bindCopy(a),(this.isIpad||this.isIphone)&&b.fixIpad(a),this.useStyle&&b.insertStyle(a,this.colors[256],this.colors[257]))},b.bindPaste=function(a){var d=a.defaultView;c(d,"paste",function(a){var c=b.focus;if(c)return a.clipboardData?c.send(a.clipboardData.getData("text/plain")):c.context.clipboardData&&c.send(c.context.clipboardData.getData("Text")),c.element.contentEditable="inherit",e(a)})},b.bindKeys=function(a){c(a,"keydown",function(a){if(b.focus){var c=a.target||a.srcElement;if(c)return c===b.focus.element||c===b.focus.context||c===b.focus.document||c===b.focus.body||c===b._textarea||c===b.focus.parent?b.focus.keyDown(a):void 0}},!0),c(a,"keypress",function(a){if(b.focus){var c=a.target||a.srcElement;if(c)return c===b.focus.element||c===b.focus.context||c===b.focus.document||c===b.focus.body||c===b._textarea||c===b.focus.parent?b.focus.keyPress(a):void 0}},!0),c(a,"mousedown",function(a){if(b.focus){var c=a.target||a.srcElement;if(c){do if(c===b.focus.element)return;while(c=c.parentNode);b.focus.blur()}}})},b.bindCopy=function(a){var d=a.defaultView;c(d,"copy",function(){var a=b.focus;if(a&&a._selected){var c=a.getCopyTextarea(),d=a.grabText(a._selected.x1,a._selected.x2,a._selected.y1,a._selected.y2);a.emit("copy",d),c.focus(),c.textContent=d,c.value=d,c.setSelectionRange(0,d.length),v(function(){a.element.focus(),a.focus()},1)}})},b.fixIpad=function(a){var c=a.createElement("textarea");c.style.position="absolute",c.style.left="-32000px",c.style.top="-32000px",c.style.width="0px",c.style.height="0px",c.style.opacity="0",c.style.backgroundColor="transparent",c.style.borderStyle="none",c.style.outlineStyle="none",c.autocapitalize="none",c.autocorrect="off",a.getElementsByTagName("body")[0].appendChild(c),b._textarea=c,v(function(){c.focus()},1e3)},b.insertStyle=function(a,b,c){var d=a.getElementById("term-style");if(!d){var e=a.getElementsByTagName("head")[0];if(e){var d=a.createElement("style");d.id="term-style",d.innerHTML=".terminal {\n  float: left;\n  border: "+b+' solid 5px;\n  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n  font-size: 11px;\n  color: '+c+";\n  background: "+b+";\n}\n\n.terminal-cursor {\n  color: "+b+";\n  background: "+c+";\n}\n",e.insertBefore(d,e.firstChild)}}},b.prototype.open=function(a){var d,e=this,f=0;if(this.parent=a||this.parent,!this.parent)throw new Error("Terminal requires a parent element.");for(this.context=this.parent.ownerDocument.defaultView,this.document=this.parent.ownerDocument,this.body=this.document.getElementsByTagName("body")[0],this.context.navigator&&this.context.navigator.userAgent&&(this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac"),this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad"),this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone"),this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")),this.element=this.document.createElement("div"),this.element.className="terminal",this.element.style.outline="none",this.element.setAttribute("tabindex",0),this.element.style.backgroundColor=this.colors[256],this.element.style.color=this.colors[257],this.children=[];f<this.rows;f++)d=this.document.createElement("div"),this.element.appendChild(d),this.children.push(d);this.parent.appendChild(this.element),this.refresh(0,this.rows-1),this.initGlobal(),this.focus(),this.startBlink(),c(this.element,"focus",function(){e.focus(),(e.isIpad||e.isIphone)&&b._textarea.focus()}),c(this.element,"mousedown",function(){e.focus()}),c(this.element,"mousedown",function(a){var b=null!=a.button?+a.button:null!=a.which?a.which-1:null;e.isMSIE&&(b=1===b?0:4===b?1:b),2===b&&(e.element.contentEditable="true",v(function(){e.element.contentEditable="inherit"},1))},!0),this.bindMouse(),null==b.brokenBold&&(b.brokenBold=g(this.document)),v(function(){e.element.focus()},100)},b.prototype.bindMouse=function(){function a(a){var b,c;if(b=h(a),c=i(a))switch(g(b,c),a.type){case"mousedown":l=b;break;case"mouseup":l=32;break;case m:}}function b(a){var b,c=l;b=i(a),b&&(c+=32,g(c,b))}function f(a,b){if(k.utfMouse){if(2047===b)return a.push(0);127>b?a.push(b):(b>2047&&(b=2047),a.push(192|b>>6),a.push(128|63&b))}else{if(255===b)return a.push(0);b>127&&(b=127),a.push(b)}}function g(a,b){if(k.vt300Mouse){a&=3,b.x-=32,b.y-=32;var c="[24";if(0===a)c+="1";else if(1===a)c+="3";else if(2===a)c+="5";else{if(3===a)return;c+="0"}return c+="~["+b.x+","+b.y+"]\r",void k.send(c)}if(k.decLocator)return a&=3,b.x-=32,b.y-=32,0===a?a=2:1===a?a=4:2===a?a=6:3===a&&(a=3),void k.send("["+a+";"+(3===a?4:0)+";"+b.y+";"+b.x+";"+(b.page||0)+"&w");if(k.urxvtMouse)return b.x-=32,b.y-=32,b.x++,b.y++,void k.send("["+a+";"+b.x+";"+b.y+"M");if(k.sgrMouse)return b.x-=32,b.y-=32,void k.send("[<"+(3===(3&a)?-4&a:a)+";"+b.x+";"+b.y+(3===(3&a)?"m":"M"));var c=[];f(c,a),f(c,b.x),f(c,b.y),k.send("[M"+u.fromCharCode.apply(u,c))}function h(a){var b,c,d,e,f;switch(a.type){case"mousedown":b=null!=a.button?+a.button:null!=a.which?a.which-1:null,k.isMSIE&&(b=1===b?0:4===b?1:b);break;case"mouseup":b=3;break;case"DOMMouseScroll":b=a.detail<0?64:65;break;case"mousewheel":b=a.wheelDeltaY>0?64:65}return c=a.shiftKey?4:0,d=a.metaKey?8:0,e=a.ctrlKey?16:0,f=c|d|e,k.vt200Mouse?f&=e:k.normalMouse||(f=0),b=32+(f<<2)+b}function i(a){var b,c,d,e,f;if(null!=a.pageX){for(b=a.pageX,c=a.pageY,f=k.element;f&&f!==k.document.documentElement;)b-=f.offsetLeft,c-=f.offsetTop,f="offsetParent"in f?f.offsetParent:f.parentNode;return d=k.element.clientWidth,e=k.element.clientHeight,b=Math.round(b/d*k.cols),c=Math.round(c/e*k.rows),0>b&&(b=0),b>k.cols&&(b=k.cols),0>c&&(c=0),c>k.rows&&(c=k.rows),b+=32,c+=32,{x:b,y:c,type:a.type===m?"mousewheel":a.type}}}var j=this.element,k=this,l=32,m="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";c(j,"mousedown",function(f){return k.mouseEvents?(a(f),k.focus(),k.vt200Mouse?(a({__proto__:f,type:"mouseup"}),e(f)):(k.normalMouse&&c(k.document,"mousemove",b),k.x10Mouse||c(k.document,"mouseup",function g(c){return a(c),k.normalMouse&&d(k.document,"mousemove",b),d(k.document,"mouseup",g),e(c)}),e(f))):void 0}),c(j,m,function(b){return k.mouseEvents&&!(k.x10Mouse||k.vt300Mouse||k.decLocator)?(a(b),e(b)):void 0}),c(j,m,function(a){return k.mouseEvents||k.applicationKeypad?void 0:(k.scrollDisp("DOMMouseScroll"===a.type?a.detail<0?-5:5:a.wheelDeltaY>0?-5:5),e(a))})},b.prototype.destroy=function(){this.readable=!1,this.writable=!1,this._events={},this.handler=function(){},this.write=function(){},this.element.parentNode&&this.element.parentNode.removeChild(this.element)},b.prototype.refresh=function(a,c){var d,e,f,g,h,j,k,l,m,n,o,p,q,r;for(c-a>=this.rows/2&&(r=this.element.parentNode,r&&r.removeChild(this.element)),k=this.cols,e=a,c>=this.lines.length&&(this.log("`end` is too large. Most likely a bad CSR."),c=this.lines.length-1);c>=e;e++){for(q=e+this.ydisp,g=this.lines[q],h="",d=e!==this.y||!this.cursorState||this.ydisp!==this.ybase&&!this.selectMode||this.cursorHidden?-1:this.x,m=this.defAttr,f=0;k>f;f++){switch(l=g[f][0],j=g[f][1],f===d&&(l=-1),l!==m&&(m!==this.defAttr&&(h+="</span>"),l!==this.defAttr&&(-1===l?h+='<span class="reverse-video terminal-cursor">':(h+='<span style="',n=511&l,o=l>>9&511,p=l>>18,1&p&&(b.brokenBold||(h+="font-weight:bold;"),8>o&&(o+=8)),2&p&&(h+="text-decoration:underline;"),4&p&&(2&p?(h=h.slice(0,-1),h+=" blink;"):h+="text-decoration:blink;"),8&p&&(n=l>>9&511,o=511&l,1&p&&8>o&&(o+=8)),16&p&&(h+="visibility:hidden;"),256!==n&&(h+="background-color:"+this.colors[n]+";"),257!==o&&(h+="color:"+this.colors[o]+";"),h+='">'))),j){case"&":h+="&amp;";break;case"<":h+="&lt;";break;case">":h+="&gt;";break;default:" ">=j?h+="&nbsp;":(i(j)&&f++,h+=j)}m=l}m!==this.defAttr&&(h+="</span>"),this.children[e].innerHTML=h}r&&r.appendChild(this.element)},b.prototype._cursorBlink=function(){b.focus===this&&(this.cursorState^=1,this.refresh(this.y,this.y))},b.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))},b.prototype.startBlink=function(){if(this.cursorBlink){var a=this;this._blinker=function(){a._cursorBlink()},this._blink=w(this._blinker,500)}},b.prototype.refreshBlink=function(){this.cursorBlink&&(clearInterval(this._blink),this._blink=w(this._blinker,500))},b.prototype.scroll=function(){var a;++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1)),this.ydisp=this.ybase,a=this.ybase+this.rows-1,a-=this.rows-1-this.scrollBottom,a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine()),0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1)),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},b.prototype.scrollDisp=function(a){this.ydisp+=a,this.ydisp>this.ybase?this.ydisp=this.ybase:this.ydisp<0&&(this.ydisp=0),this.refresh(0,this.rows-1)},b.prototype.write=function(a){var c,d,e,f=a.length,g=0;for(this.refreshStart=this.y,this.refreshEnd=this.y,this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange());f>g;g++)switch(e=a[g],this.state){case n:switch(e){case"":this.bell();break;case"\n":case"":case"\f":this.convertEol&&(this.x=0),this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());break;case"\r":this.x=0;break;case"\b":this.x>0&&this.x--;break;case"	":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=o;break;default:if(e>=" "&&(this.charset&&this.charset[e]&&(e=this.charset[e]),this.x>=this.cols&&(this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,e],this.x++,this.updateRange(this.y),i(e))){if(c=this.y+this.ybase,this.cols<2||this.x>=this.cols){this.lines[c][this.x-1]=[this.curAttr," "];break}this.lines[c][this.x]=[this.curAttr," "],this.x++}}break;case o:switch(e){case"[":this.params=[],this.currentParam=0,this.state=p;break;case"]":this.params=[],this.currentParam=0,this.state=q;break;case"P":this.params=[],this.currentParam=0,this.state=s;break;case"_":this.state=t;break;case"^":this.state=t;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0),this.setgCharset(0,b.charsets.US),this.state=n,g++;break;case"(":case")":case"*":case"+":case"-":case".":switch(e){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2}this.state=r;break;case"/":this.gcharset=3,this.state=r,g--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor(),this.state=n;break;case"8":this.restoreCursor(),this.state=n;break;case"#":this.state=n,g++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad."),this.applicationKeypad=!0,this.state=n;break;case">":this.log("Switching back to normal keypad."),this.applicationKeypad=!1,this.state=n;break;default:this.state=n,this.error("Unknown ESC control: %s.",e)}break;case r:switch(e){case"0":d=b.charsets.SCLD;break;case"A":d=b.charsets.UK;break;case"B":d=b.charsets.US;break;case"4":d=b.charsets.Dutch;break;case"C":case"5":d=b.charsets.Finnish;break;case"R":d=b.charsets.French;break;case"Q":d=b.charsets.FrenchCanadian;break;case"K":d=b.charsets.German;break;case"Y":d=b.charsets.Italian;break;case"E":case"6":d=b.charsets.NorwegianDanish;break;case"Z":d=b.charsets.Spanish;break;case"H":case"7":d=b.charsets.Swedish;break;case"=":d=b.charsets.Swiss;break;case"/":d=b.charsets.ISOLatin,g++;break;default:d=b.charsets.US}this.setgCharset(this.gcharset,d),this.gcharset=null,this.state=n;break;case q:if(""===e||""===e){switch(""===e&&g++,this.params.push(this.currentParam),this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title));break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:}this.params=[],this.currentParam=0,this.state=n}else this.params.length?this.currentParam+=e:e>="0"&&"9">=e?this.currentParam=10*this.currentParam+e.charCodeAt(0)-48:";"===e&&(this.params.push(this.currentParam),this.currentParam="");break;case p:if("?"===e||">"===e||"!"===e){this.prefix=e;break}if(e>="0"&&"9">=e){this.currentParam=10*this.currentParam+e.charCodeAt(0)-48;break}if("$"===e||'"'===e||" "===e||"'"===e){this.postfix=e;break}if(this.params.push(this.currentParam),this.currentParam=0,";"===e)break;switch(this.state=n,e){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.prefix||this.charAttributes(this.params);break;case"n":this.prefix||this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":this.params.length<2&&!this.prefix&&this.scrollDown(this.params);break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",e)}this.prefix="",this.postfix="";break;case s:if(""===e||""===e){switch(""===e&&g++,this.prefix){case"":break;case"$q":var h=this.currentParam,j=!1;switch(h){case'"q':h='0"q';break;case'"p':h='61"p';break;case"r":h=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case"m":h="0m";break;default:this.error("Unknown DCS Pt: %s.",h),h=""}this.send("P"+ +j+"$r"+h+"\\");break;case"+p":break;case"+q":var h=this.currentParam,j=!1;this.send("P"+ +j+"+r"+h+"\\");break;default:this.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0,this.prefix="",this.state=n}else this.currentParam?this.currentParam+=e:this.prefix||"$"===e||"+"===e?2===this.prefix.length?this.currentParam=e:this.prefix+=e:this.currentParam=e;break;case t:(""===e||""===e)&&(""===e&&g++,this.state=n)}this.updateRange(this.y),this.refresh(this.refreshStart,this.refreshEnd)},b.prototype.writeln=function(a){this.write(a+"\r\n")},b.prototype.keyDown=function(a){var b,c=this;switch(a.keyCode){case 8:if(a.shiftKey){b="\b";break}b="";break;case 9:if(a.shiftKey){b="[Z";break}b="	";break;case 13:b="\r";break;case 27:b="";break;case 37:if(this.applicationCursor){b="OD";break}b="[D";break;case 39:if(this.applicationCursor){b="OC";break}b="[C";break;case 38:if(this.applicationCursor){b="OA";break}if(a.ctrlKey)return this.scrollDisp(-1),e(a);b="[A";break;case 40:if(this.applicationCursor){b="OB";break}if(a.ctrlKey)return this.scrollDisp(1),e(a);b="[B";break;case 46:b="[3~";break;case 45:b="[2~";break;case 36:if(this.applicationKeypad){b="OH";break}b="OH";break;case 35:if(this.applicationKeypad){b="OF";break}b="OF";break;case 33:if(a.shiftKey)return this.scrollDisp(-(this.rows-1)),e(a);b="[5~";break;case 34:if(a.shiftKey)return this.scrollDisp(this.rows-1),e(a);b="[6~";break;case 112:b="OP";break;case 113:b="OQ";break;case 114:b="OR";break;case 115:b="OS";break;case 116:b="[15~";break;case 117:b="[17~";break;case 118:b="[18~";break;case 119:b="[19~";break;case 120:b="[20~";break;case 121:b="[21~";break;case 122:b="[23~";break;case 123:b="[24~";break;default:if(a.ctrlKey)if(a.keyCode>=65&&a.keyCode<=90){if(this.screenKeys&&!this.prefixMode&&!this.selectMode&&65===a.keyCode)return this.enterPrefix(),e(a);if(this.prefixMode&&86===a.keyCode)return void this.leavePrefix();if((this.prefixMode||this.selectMode)&&67===a.keyCode)return void(this.visualMode&&v(function(){c.leaveVisual()},1));b=u.fromCharCode(a.keyCode-64)}else 32===a.keyCode?b=u.fromCharCode(0):a.keyCode>=51&&a.keyCode<=55?b=u.fromCharCode(a.keyCode-51+27):56===a.keyCode?b=u.fromCharCode(127):219===a.keyCode?b=u.fromCharCode(27):221===a.keyCode&&(b=u.fromCharCode(29));else(!this.isMac&&a.altKey||this.isMac&&a.metaKey)&&(a.keyCode>=65&&a.keyCode<=90?b=""+u.fromCharCode(a.keyCode+32):192===a.keyCode?b="`":a.keyCode>=48&&a.keyCode<=57&&(b=""+(a.keyCode-48)))}return b?this.prefixMode?(this.leavePrefix(),e(a)):this.selectMode?(this.keySelect(a,b),e(a)):(this.emit("keydown",a),this.emit("key",b,a),this.showCursor(),this.handler(b),e(a)):!0},b.prototype.setgLevel=function(a){this.glevel=a,this.charset=this.charsets[a]},b.prototype.setgCharset=function(a,b){this.charsets[a]=b,this.glevel===a&&(this.charset=b)},b.prototype.keyPress=function(a){var b;if(e(a),a.charCode)b=a.charCode;else if(null==a.which)b=a.keyCode;else{if(0===a.which||0===a.charCode)return!1;b=a.which}return!b||a.ctrlKey||a.altKey||a.metaKey?!1:(b=u.fromCharCode(b),this.prefixMode?(this.leavePrefix(),this.keyPrefix(a,b),!1):this.selectMode?(this.keySelect(a,b),!1):(this.emit("keypress",b,a),this.emit("key",b,a),this.showCursor(),this.handler(b),!1))},b.prototype.send=function(a){var b=this;this.queue||v(function(){b.handler(b.queue),b.queue=""},1),this.queue+=a},b.prototype.bell=function(){if(this.visualBell){var a=this;this.element.style.borderColor="white",v(function(){a.element.style.borderColor=""},10),this.popOnBell&&this.focus()}},b.prototype.log=function(){if(this.debug&&this.context.console&&this.context.console.log){var a=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,a)}},b.prototype.error=function(){if(this.debug&&this.context.console&&this.context.console.error){var a=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,a)}},b.prototype.resize=function(a,b){var c,d,e,f,g;if(1>a&&(a=1),1>b&&(b=1),f=this.cols,a>f)for(g=[this.defAttr," "],e=this.lines.length;e--;)for(;this.lines[e].length<a;)this.lines[e].push(g);else if(f>a)for(e=this.lines.length;e--;)for(;this.lines[e].length>a;)this.lines[e].pop();if(this.setupStops(f),this.cols=a,f=this.rows,b>f)for(d=this.element;f++<b;)this.lines.length<b+this.ybase&&this.lines.push(this.blankLine()),this.children.length<b&&(c=this.document.createElement("div"),d.appendChild(c),this.children.push(c));else if(f>b)for(;f-->b;)if(this.lines.length>b+this.ybase&&this.lines.pop(),this.children.length>b){if(d=this.children.pop(),!d)continue;d.parentNode.removeChild(d)}this.rows=b,this.y>=b&&(this.y=b-1),this.x>=a&&(this.x=a-1),this.scrollTop=0,this.scrollBottom=b-1,this.refresh(0,this.rows-1),this.normal=null},b.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=a),a>this.refreshEnd&&(this.refreshEnd=a)},b.prototype.maxRange=function(){this.refreshStart=0,this.refreshEnd=this.rows-1},b.prototype.setupStops=function(a){for(null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);a<this.cols;a+=8)this.tabs[a]=!0},b.prototype.prevStop=function(a){for(null==a&&(a=this.x);!this.tabs[--a]&&a>0;);return a>=this.cols?this.cols-1:0>a?0:a},b.prototype.nextStop=function(a){for(null==a&&(a=this.x);!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-1:0>a?0:a},b.prototype.eraseRight=function(a,b){for(var c=this.lines[this.ybase+b],d=[this.eraseAttr()," "];a<this.cols;a++)c[a]=d;this.updateRange(b)},b.prototype.eraseLeft=function(a,b){var c=this.lines[this.ybase+b],d=[this.eraseAttr()," "];for(a++;a--;)c[a]=d;this.updateRange(b)},b.prototype.eraseLine=function(a){this.eraseRight(0,a)},b.prototype.blankLine=function(a){for(var b=a?this.eraseAttr():this.defAttr,c=[b," "],d=[],e=0;e<this.cols;e++)d[e]=c;return d},b.prototype.ch=function(a){return a?[this.eraseAttr()," "]:[this.defAttr," "]},b.prototype.is=function(a){var b=this.termName;return 0===(b+"").indexOf(a)},b.prototype.handler=function(a){this.emit("data",a)},b.prototype.handleTitle=function(a){this.emit("title",a)},b.prototype.index=function(){this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll()),this.state=n},b.prototype.reverseIndex=function(){var a;this.y--,this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)),this.state=n},b.prototype.reset=function(){this.options.rows=this.rows,this.options.cols=this.cols,b.call(this,this.options),this.refresh(0,this.rows-1)},b.prototype.tabSet=function(){this.tabs[this.x]=!0,this.state=n},b.prototype.cursorUp=function(a){var b=a[0];1>b&&(b=1),this.y-=b,this.y<0&&(this.y=0)},b.prototype.cursorDown=function(a){var b=a[0];1>b&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},b.prototype.cursorForward=function(a){var b=a[0];1>b&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},b.prototype.cursorBackward=function(a){var b=a[0];
1>b&&(b=1),this.x-=b,this.x<0&&(this.x=0)},b.prototype.cursorPos=function(a){var b,c;b=a[0]-1,c=a.length>=2?a[1]-1:0,0>b?b=0:b>=this.rows&&(b=this.rows-1),0>c?c=0:c>=this.cols&&(c=this.cols-1),this.x=c,this.y=b},b.prototype.eraseInDisplay=function(a){var b;switch(a[0]){case 0:for(this.eraseRight(this.x,this.y),b=this.y+1;b<this.rows;b++)this.eraseLine(b);break;case 1:for(this.eraseLeft(this.x,this.y),b=this.y;b--;)this.eraseLine(b);break;case 2:for(b=this.rows;b--;)this.eraseLine(b);break;case 3:}},b.prototype.eraseInLine=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}},b.prototype.charAttributes=function(a){if(1===a.length&&0===a[0])return void(this.curAttr=this.defAttr);for(var b,c=a.length,d=0,e=this.curAttr>>18,f=this.curAttr>>9&511,g=511&this.curAttr;c>d;d++)b=a[d],b>=30&&37>=b?f=b-30:b>=40&&47>=b?g=b-40:b>=90&&97>=b?(b+=8,f=b-90):b>=100&&107>=b?(b+=8,g=b-100):0===b?(e=this.defAttr>>18,f=this.defAttr>>9&511,g=511&this.defAttr):1===b?e|=1:4===b?e|=2:5===b?e|=4:7===b?e|=8:8===b?e|=16:22===b?e&=-2:24===b?e&=-3:25===b?e&=-5:27===b?e&=-9:28===b?e&=-17:39===b?f=this.defAttr>>9&511:49===b?g=511&this.defAttr:38===b?2===a[d+1]?(d+=2,f=j(255&a[d],255&a[d+1],255&a[d+2]),-1===f&&(f=511),d+=2):5===a[d+1]&&(d+=2,b=255&a[d],f=b):48===b?2===a[d+1]?(d+=2,g=j(255&a[d],255&a[d+1],255&a[d+2]),-1===g&&(g=511),d+=2):5===a[d+1]&&(d+=2,b=255&a[d],g=b):100===b?(f=this.defAttr>>9&511,g=511&this.defAttr):this.error("Unknown SGR attribute: %d.",b);this.curAttr=e<<18|f<<9|g},b.prototype.deviceStatus=function(a){if(this.prefix){if("?"===this.prefix)switch(a[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:}}else switch(a[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R")}},b.prototype.insertChars=function(a){var b,c,d,e;for(b=a[0],1>b&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.eraseAttr()," "];b--&&d<this.cols;)this.lines[c].splice(d++,0,e),this.lines[c].pop()},b.prototype.cursorNextLine=function(a){var b=a[0];1>b&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1),this.x=0},b.prototype.cursorPrecedingLine=function(a){var b=a[0];1>b&&(b=1),this.y-=b,this.y<0&&(this.y=0),this.x=0},b.prototype.cursorCharAbsolute=function(a){var b=a[0];1>b&&(b=1),this.x=b-1},b.prototype.insertLines=function(a){var b,c,d;for(b=a[0],1>b&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d+1;b--;)this.lines.splice(c,0,this.blankLine(!0)),this.lines.splice(d,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},b.prototype.deleteLines=function(a){var b,c,d;for(b=a[0],1>b&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d;b--;)this.lines.splice(d+1,0,this.blankLine(!0)),this.lines.splice(c,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},b.prototype.deleteChars=function(a){var b,c,d;for(b=a[0],1>b&&(b=1),c=this.y+this.ybase,d=[this.eraseAttr()," "];b--;)this.lines[c].splice(this.x,1),this.lines[c].push(d)},b.prototype.eraseChars=function(a){var b,c,d,e;for(b=a[0],1>b&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.eraseAttr()," "];b--&&d<this.cols;)this.lines[c][d++]=e},b.prototype.charPosAbsolute=function(a){var b=a[0];1>b&&(b=1),this.x=b-1,this.x>=this.cols&&(this.x=this.cols-1)},b.prototype.HPositionRelative=function(a){var b=a[0];1>b&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},b.prototype.sendDeviceAttributes=function(a){a[0]>0||(this.prefix?">"===this.prefix&&(this.is("xterm")?this.send("[>0;276;0c"):this.is("rxvt-unicode")?this.send("[>85;95;0c"):this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("[?1;2c"):this.is("linux")&&this.send("[?6c"))},b.prototype.linePosAbsolute=function(a){var b=a[0];1>b&&(b=1),this.y=b-1,this.y>=this.rows&&(this.y=this.rows-1)},b.prototype.VPositionRelative=function(a){var b=a[0];1>b&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},b.prototype.HVPosition=function(a){a[0]<1&&(a[0]=1),a[1]<1&&(a[1]=1),this.y=a[0]-1,this.y>=this.rows&&(this.y=this.rows-1),this.x=a[1]-1,this.x>=this.cols&&(this.x=this.cols-1)},b.prototype.setMode=function(a){if("object"!=typeof a)if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,b.charsets.US),this.setgCharset(1,b.charsets.US),this.setgCharset(2,b.charsets.US),this.setgCharset(3,b.charsets.US);break;case 3:this.savedCols=this.cols,this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 12:break;case 66:this.log("Serial port requested application keypad."),this.applicationKeypad=!0;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=9===a,this.vt200Mouse=1e3===a,this.normalMouse=a>1e3,this.mouseEvents=!0,this.element.style.cursor="default",this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:if(!this.normal){var c={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset(),this.normal=c,this.showCursor()}}}else switch(a){case 4:this.insertMode=!0;break;case 20:}else for(var d=a.length,e=0;d>e;e++)this.setMode(a[e])},b.prototype.resetMode=function(a){if("object"!=typeof a)if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows),delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 12:break;case 66:this.log("Switching back to normal keypad."),this.applicationKeypad=!1;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=!1,this.vt200Mouse=!1,this.normalMouse=!1,this.mouseEvents=!1,this.element.style.cursor="";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor())}}else switch(a){case 4:this.insertMode=!1;break;case 20:}else for(var b=a.length,c=0;b>c;c++)this.resetMode(a[c])},b.prototype.setScrollRegion=function(a){this.prefix||(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.x=0,this.y=0)},b.prototype.saveCursor=function(){this.savedX=this.x,this.savedY=this.y},b.prototype.restoreCursor=function(){this.x=this.savedX||0,this.y=this.savedY||0},b.prototype.cursorForwardTab=function(a){for(var b=a[0]||1;b--;)this.x=this.nextStop()},b.prototype.scrollUp=function(a){for(var b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},b.prototype.scrollDown=function(a){for(var b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},b.prototype.initMouseTracking=function(){},b.prototype.resetTitleModes=function(){},b.prototype.cursorBackwardTab=function(a){for(var b=a[0]||1;b--;)this.x=this.prevStop()},b.prototype.repeatPrecedingCharacter=function(a){for(var b=a[0]||1,c=this.lines[this.ybase+this.y],d=c[this.x-1]||[this.defAttr," "];b--;)c[this.x++]=d},b.prototype.tabClear=function(a){var b=a[0];0>=b?delete this.tabs[this.x]:3===b&&(this.tabs={})},b.prototype.mediaCopy=function(){},b.prototype.setResources=function(){},b.prototype.disableModifiers=function(){},b.prototype.setPointerMode=function(){},b.prototype.softReset=function(){this.cursorHidden=!1,this.insertMode=!1,this.originMode=!1,this.wraparoundMode=!1,this.applicationKeypad=!1,this.applicationCursor=!1,this.scrollTop=0,this.scrollBottom=this.rows-1,this.curAttr=this.defAttr,this.x=this.y=0,this.charset=null,this.glevel=0,this.charsets=[null]},b.prototype.requestAnsiMode=function(){},b.prototype.requestPrivateMode=function(){},b.prototype.setConformanceLevel=function(){},b.prototype.loadLEDs=function(){},b.prototype.setCursorStyle=function(){},b.prototype.setCharProtectionAttr=function(){},b.prototype.restorePrivateValues=function(){},b.prototype.setAttrInRectangle=function(a){for(var b,c,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4];f+1>d;d++)for(b=this.lines[this.ybase+d],c=e;g>c;c++)b[c]=[h,b[c][1]];this.updateRange(a[0]),this.updateRange(a[2])},b.prototype.savePrivateValues=function(){},b.prototype.manipulateWindow=function(){},b.prototype.reverseAttrInRectangle=function(){},b.prototype.setTitleModeFeature=function(){},b.prototype.setWarningBellVolume=function(){},b.prototype.setMarginBellVolume=function(){},b.prototype.copyRectangle=function(){},b.prototype.enableFilterRectangle=function(){},b.prototype.requestParameters=function(){},b.prototype.selectChangeExtent=function(){},b.prototype.fillRectangle=function(a){for(var b,c,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4];g+1>e;e++)for(b=this.lines[this.ybase+e],c=f;h>c;c++)b[c]=[b[c][0],u.fromCharCode(d)];this.updateRange(a[1]),this.updateRange(a[3])},b.prototype.enableLocatorReporting=function(a){a[0]>0},b.prototype.eraseRectangle=function(a){var b,c,d,e=a[0],f=a[1],g=a[2],h=a[3];for(d=[this.eraseAttr()," "];g+1>e;e++)for(b=this.lines[this.ybase+e],c=f;h>c;c++)b[c]=d;this.updateRange(a[0]),this.updateRange(a[2])},b.prototype.setLocatorEvents=function(){},b.prototype.selectiveEraseRectangle=function(){},b.prototype.requestLocatorPosition=function(){},b.prototype.insertColumns=function(){for(var a,b=params[0],c=this.ybase+this.rows,d=[this.eraseAttr()," "];b--;)for(a=this.ybase;c>a;a++)this.lines[a].splice(this.x+1,0,d),this.lines[a].pop();this.maxRange()},b.prototype.deleteColumns=function(){for(var a,b=params[0],c=this.ybase+this.rows,d=[this.eraseAttr()," "];b--;)for(a=this.ybase;c>a;a++)this.lines[a].splice(this.x,1),this.lines[a].push(d);this.maxRange()},b.prototype.enterPrefix=function(){this.prefixMode=!0},b.prototype.leavePrefix=function(){this.prefixMode=!1},b.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write},this.write=function(){},this.selectMode=!0,this.visualMode=!1,this.cursorHidden=!1,this.refresh(this.y,this.y)},b.prototype.leaveSelect=function(){this.x=this._real.x,this.y=this._real.y,this.ydisp=this._real.ydisp,this.ybase=this._real.ybase,this.cursorHidden=this._real.cursorHidden,this.lines=this._real.lines,this.write=this._real.write,delete this._real,this.selectMode=!1,this.visualMode=!1,this.refresh(0,this.rows-1)},b.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines),this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y),this.visualMode=!0},b.prototype.leaveVisual=function(){this.lines=this._real.preVisual,delete this._real.preVisual,delete this._selected,this.visualMode=!1,this.refresh(0,this.rows-1)},b.prototype.enterSearch=function(a){this.entry="",this.searchMode=!0,this.searchDown=a,this._real.preSearch=this.copyBuffer(this.lines),this._real.preSearchX=this.x,this._real.preSearchY=this.y;for(var b=this.ydisp+this.rows-1,c=0;c<this.entryPrefix.length;c++)this.lines[b][c]=[-512&this.defAttr|4,this.entryPrefix[c]];this.y=this.rows-1,this.x=this.entryPrefix.length,this.refresh(this.rows-1,this.rows-1)},b.prototype.leaveSearch=function(){this.searchMode=!1,this._real.preSearch&&(this.lines=this._real.preSearch,this.x=this._real.preSearchX,this.y=this._real.preSearchY,delete this._real.preSearch,delete this._real.preSearchX,delete this._real.preSearchY),this.refresh(this.rows-1,this.rows-1)},b.prototype.copyBuffer=function(a){for(var a=a||this.lines,b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length;d++)b[c][d]=[a[c][d][0],a[c][d][1]]}return b},b.prototype.getCopyTextarea=function(){var a=this._copyTextarea,b=this.document;return a||(a=b.createElement("textarea"),a.style.position="absolute",a.style.left="-32000px",a.style.top="-32000px",a.style.width="0px",a.style.height="0px",a.style.opacity="0",a.style.backgroundColor="transparent",a.style.borderStyle="none",a.style.outlineStyle="none",b.getElementsByTagName("body")[0].appendChild(a),this._copyTextarea=a),a},b.prototype.copyText=function(a){var b=this,c=this.getCopyTextarea();this.emit("copy",a),c.focus(),c.textContent=a,c.value=a,c.setSelectionRange(0,a.length),v(function(){b.element.focus(),b.focus()},1)},b.prototype.selectText=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;if(this._selected){for(e=this._selected.x1,f=this._selected.x2,g=this._selected.y1,h=this._selected.y2,g>h&&(i=f,f=e,e=i,i=h,h=g,g=i),e>f&&g===h&&(i=f,f=e,e=i),k=g;h>=k;k++)for(j=0,l=this.cols-1,k===g&&(j=e),k===h&&(l=f);l>=j;j++)null!=this.lines[k][j].old&&(m=this.lines[k][j].old,delete this.lines[k][j].old,this.lines[k][j]=[m,this.lines[k][j][1]]);c=this._selected.y1,a=this._selected.x1}for(c=Math.max(c,0),c=Math.min(c,this.ydisp+this.rows-1),d=Math.max(d,0),d=Math.min(d,this.ydisp+this.rows-1),this._selected={x1:a,x2:b,y1:c,y2:d},c>d&&(i=b,b=a,a=i,i=d,d=c,c=i),a>b&&c===d&&(i=b,b=a,a=i),k=c;d>=k;k++)for(j=0,l=this.cols-1,k===c&&(j=a),k===d&&(l=b);l>=j;j++)m=this.lines[k][j][0],this.lines[k][j]=[-512&m|261636,this.lines[k][j][1]],this.lines[k][j].old=m;c-=this.ydisp,d-=this.ydisp,c=Math.max(c,0),c=Math.min(c,this.rows-1),d=Math.max(d,0),d=Math.min(d,this.rows-1),this.refresh(0,this.rows-1)},b.prototype.grabText=function(a,b,c,d){var e,f,g,h,j,k="",l="";for(c>d&&(j=b,b=a,a=j,j=d,d=c,c=j),a>b&&c===d&&(j=b,b=a,a=j),g=c;d>=g;g++){for(f=0,h=this.cols-1,g===c&&(f=a),g===d&&(h=b);h>=f;f++)e=this.lines[g][f][1]," "!==e?(l&&(k+=l,l=""),k+=e,i(e)&&f++):l+=e;l="",k+="\n"}for(f=b,g=d;f<this.cols;f++)if(" "!==this.lines[g][f][1]){k=k.slice(0,-1);break}return k},b.prototype.keyPrefix=function(a,b){"k"===b||"&"===b?this.destroy():"p"===b||"]"===b?this.emit("request paste"):"c"===b?this.emit("request create"):b>="0"&&"9">=b?(b=+b-1,~b||(b=9),this.emit("request term",b)):"n"===b?this.emit("request term next"):"P"===b?this.emit("request term previous"):":"===b?this.emit("request command mode"):"["===b&&this.enterSelect()},b.prototype.keySelect=function(a,b){if(this.showCursor(),this.searchMode||"n"===b||"N"===b)return this.keySearch(a,b);if(""===b){var c=this.ydisp+this.y;return this.ydisp===this.ybase?(this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1),this.refresh(0,this.rows-1)):this.scrollDisp((this.rows-1)/2|0),void(this.visualMode&&this.selectText(this.x,this.x,c,this.ydisp+this.y))}if(""===b){var c=this.ydisp+this.y;return 0===this.ydisp?(this.y=Math.max(this.y-(this.rows-1)/2|0,0),this.refresh(0,this.rows-1)):this.scrollDisp(-(this.rows-1)/2|0),void(this.visualMode&&this.selectText(this.x,this.x,c,this.ydisp+this.y))}if(""===b){var c=this.ydisp+this.y;return this.scrollDisp(this.rows-1),void(this.visualMode&&this.selectText(this.x,this.x,c,this.ydisp+this.y))}if(""===b){var c=this.ydisp+this.y;return this.scrollDisp(-(this.rows-1)),void(this.visualMode&&this.selectText(this.x,this.x,c,this.ydisp+this.y))}if("k"===b||"[A"===b){var c=this.ydisp+this.y;return this.y--,this.y<0&&(this.y=0,this.scrollDisp(-1)),void(this.visualMode?this.selectText(this.x,this.x,c,this.ydisp+this.y):this.refresh(this.y,this.y+1))}if("j"===b||"[B"===b){var c=this.ydisp+this.y;return this.y++,this.y>=this.rows&&(this.y=this.rows-1,this.scrollDisp(1)),void(this.visualMode?this.selectText(this.x,this.x,c,this.ydisp+this.y):this.refresh(this.y-1,this.y))}if("h"===b||"[D"===b){var d=this.x;return this.x--,this.x<0&&(this.x=0),void(this.visualMode?this.selectText(d,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("l"===b||"[C"===b){var d=this.x;return this.x++,this.x>=this.cols&&(this.x=this.cols-1),void(this.visualMode?this.selectText(d,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("v"===b||" "===b)return void(this.visualMode?this.leaveVisual():this.enterVisual());if("y"!==b){if("q"===b||""===b)return void(this.visualMode?this.leaveVisual():this.leaveSelect());if("w"===b||"W"===b){for(var e=this.x,f=this.y,g=this.ydisp,d=this.x,c=this.y,h=this.ydisp,i=!1;;){for(var j=this.lines[h+c];d<this.cols;){if(j[d][1]<=" ")i=!0;else if(i)break;d++}if(d>=this.cols&&(d=this.cols-1),!(d===this.cols-1&&j[d][1]<=" "))break;if(d=0,++c>=this.rows&&(c--,++h>this.ybase)){h=this.ybase,d=this.x;break}}return this.x=d,this.y=c,this.scrollDisp(-this.ydisp+h),void(this.visualMode&&this.selectText(e,this.x,f+g,this.ydisp+this.y))}if("b"===b||"B"===b){for(var e=this.x,f=this.y,g=this.ydisp,d=this.x,c=this.y,h=this.ydisp;;){for(var j=this.lines[h+c],i=d>0&&j[d][1]>" "&&j[d-1][1]>" ";d>=0;){if(j[d][1]<=" "){if(i&&d+1<this.cols&&j[d+1][1]>" "){d++;break}i=!0}d--}if(0>d&&(d=0),0!==d||!(j[d][1]<=" ")&&i)break;if(d=this.cols-1,--c<0&&(c++,--h<0)){h++,d=0;break}}return this.x=d,this.y=c,this.scrollDisp(-this.ydisp+h),void(this.visualMode&&this.selectText(e,this.x,f+g,this.ydisp+this.y))}if("e"===b||"E"===b){var d=this.x+1,c=this.y,h=this.ydisp;for(d>=this.cols&&d--;;){for(var j=this.lines[h+c];d<this.cols&&j[d][1]<=" ";)d++;for(;d<this.cols;){if(j[d][1]<=" "&&d-1>=0&&j[d-1][1]>" "){d--;break}d++}if(d>=this.cols&&(d=this.cols-1),!(d===this.cols-1&&j[d][1]<=" "))break;if(d=0,++c>=this.rows&&(c--,++h>this.ybase)){h=this.ybase;break}}return this.x=d,this.y=c,this.scrollDisp(-this.ydisp+h),void(this.visualMode&&this.selectText(e,this.x,f+g,this.ydisp+this.y))}if("^"===b||"0"===b){var e=this.x;if("0"===b)this.x=0;else if("^"===b){for(var j=this.lines[this.ydisp+this.y],d=0;d<this.cols&&!(j[d][1]>" ");)d++;d>=this.cols&&(d=this.cols-1),this.x=d}return void(this.visualMode?this.selectText(e,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("$"===b){for(var e=this.x,j=this.lines[this.ydisp+this.y],d=this.cols-1;d>=0;){if(j[d][1]>" "){this.visualMode&&d<this.cols-1&&d++;break}d--}return 0>d&&(d=0),this.x=d,void(this.visualMode?this.selectText(e,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("g"===b||"G"===b){var e=this.x,f=this.y,g=this.ydisp;return"g"===b?(this.x=0,this.y=0,this.scrollDisp(-this.ydisp)):"G"===b&&(this.x=0,this.y=this.rows-1,this.scrollDisp(this.ybase)),void(this.visualMode&&this.selectText(e,this.x,f+g,this.ydisp+this.y))}if("H"===b||"M"===b||"L"===b){var e=this.x,f=this.y;return"H"===b?(this.x=0,this.y=0):"M"===b?(this.x=0,this.y=this.rows/2|0):"L"===b&&(this.x=0,this.y=this.rows-1),void(this.visualMode?this.selectText(e,this.x,this.ydisp+f,this.ydisp+this.y):(this.refresh(f,f),this.refresh(this.y,this.y)))}if("{"===b||"}"===b){var j,k,e=this.x,f=this.y,g=this.ydisp,l=!1,m=!1,n=-1,c=this.y+("{"===b?-1:1),h=this.ydisp;for("{"===b?0>c&&(c++,h>0&&h--):"}"===b&&c>=this.rows&&(c--,h<this.ybase&&h++);;){for(j=this.lines[h+c],k=0;k<this.cols;k++){if(j[k][1]>" "){-1===n&&(n=0),l=!0;break}if(k===this.cols-1){-1===n?n=1:0===n?m=!0:1===n&&l&&(m=!0);break}}if(m)break;if("{"===b){if(c--,0>c){if(c++,!(h>0))break;h--}}else if("}"===b&&(c++,c>=this.rows)){if(c--,!(h<this.ybase))break;h++}}return m||("{"===b?(c=0,h=0):"}"===b&&(c=this.rows-1,h=this.ybase)),this.x=0,this.y=c,this.scrollDisp(-this.ydisp+h),void(this.visualMode&&this.selectText(e,this.x,f+g,this.ydisp+this.y))}return"/"===b||"?"===b?void(this.visualMode||this.enterSearch("/"===b)):!1}if(this.visualMode){var o=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2);this.copyText(o),this.leaveVisual()}},b.prototype.keySearch=function(a,b){if(""===b)return void this.leaveSearch();if("\r"===b||!this.searchMode&&("n"===b||"N"===b)){this.leaveSearch();var c=this.entry;if(!c)return void this.refresh(0,this.rows-1);for(var d,e,f,g=this.x,h=this.y,i=this.ydisp,j=!1,k=!1,l=this.x+1,m=this.ydisp+this.y,n="N"===b?this.searchDown:!this.searchDown;;){for(d=this.lines[m];l<this.cols;){for(f=0;f<c.length&&!(l+f>=this.cols)&&d[l+f][1]===c[f];f++)if(d[l+f][1]===c[f]&&f===c.length-1){j=!0;break}if(j)break;l+=f+1}if(j)break;if(l=0,n){if(m--,0>m){if(k)break;k=!0,m=this.ybase+this.rows-1}}else if(m++,m>this.ybase+this.rows-1){if(k)break;k=!0,m=0}}return j?(m-this.ybase<0?(e=m,m=0,e>this.ybase&&(m=e-this.ybase,e=this.ybase)):(e=this.ybase,m-=this.ybase),this.x=l,this.y=m,this.scrollDisp(-this.ydisp+e),void(this.visualMode&&this.selectText(g,this.x,h+i,this.ydisp+this.y))):void this.refresh(0,this.rows-1)}if("\b"===b||""===b){if(0===this.entry.length)return;var o=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);var f=this.entryPrefix.length+this.entry.length;return this.lines[o][f]=[this.lines[o][f][0]," "],this.x--,this.refresh(this.rows-1,this.rows-1),void this.refresh(this.y,this.y)}if(1===b.length&&b>=" "&&"~">=b){var o=this.ydisp+this.rows-1;this.entry+=b;var f=this.entryPrefix.length+this.entry.length-1;return this.lines[o][f]=[-512&this.defAttr|4,b],this.x++,this.refresh(this.rows-1,this.rows-1),void this.refresh(this.y,this.y)}return!1},b.charsets={},b.charsets.SCLD={"`":"◆",a:"▒",b:"	",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},b.charsets.UK=null,b.charsets.US=null,b.charsets.Dutch=null,b.charsets.Finnish=null,b.charsets.French=null,b.charsets.FrenchCanadian=null,b.charsets.German=null,b.charsets.Italian=null,b.charsets.NorwegianDanish=null,b.charsets.Spanish=null,b.charsets.Swedish=null,b.charsets.Swiss=null,b.charsets.ISOLatin=null;var u=this.String,v=this.setTimeout,w=this.setInterval;j._cache={},j.distance=function(a,b,c,d,e,f){return Math.pow(30*(a-d),2)+Math.pow(59*(b-e),2)+Math.pow(11*(c-f),2)},b.EventEmitter=a,b.inherits=f,b.on=c,b.off=d,b.cancel=e,"undefined"!=typeof module?module.exports=b:this.Terminal=b}.call(function(){return this||("undefined"!=typeof window?window:global)}()),angular.module("dockerIde",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ui.codemirror","mm.foundation","LocalStorageModule","angularFileUpload","configuration"]).run(["$rootScope","$http","$window","$state","MODE",function(a,b,c,d,e){a.$state=d,a.mode=e}]).config(["$compileProvider","$urlRouterProvider",function(a,b){a.aHrefSanitizationWhitelist(/^\s*(https?|data):/),b.otherwise("/")}]);var app=angular.module("dockerIde");app.directive("autofocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c[0].focus()})}}}]);var app=angular.module("dockerIde"),Tar;Tar=require("tar-js"),app.factory("docker",["$http","$log","$q","$location","MODE","localStorageService",function(a,b,c,d,e,f){function g(){}function h(){if("embedded"===e)return d.protocol()+"://"+d.host()+":"+d.port();var a=f.get("dockerUrl");return a&&!/^http/.test(a)&&(a="http://"+a),a}return g.prototype.setContext=function(a){this.context=a},g.prototype.ping=function(){var b=h();return a.get(b+"/_ping",{timeout:2e3})},g.prototype.connect=function(d){b.debug("Sending connect request.");var e=c.defer(),f=h();return a.post(f+"/containers/create",{AttachStdin:!0,AttachStdout:!0,AttachStderr:!0,Tty:!0,OpenStdin:!0,StdinOnce:!0,Entrypoint:["/bin/sh"],Image:d}).then(function(b){var c=b.data.Id,d=new WebSocket(f.replace(/^http/,"ws")+"/containers/"+c+"/attach/ws?logs=1&stderr=1&stdout=1&stream=1&stdin=1");a.post(f+"/containers/"+c+"/start").then(function(){e.resolve(d)},function(){e.reject("Error starting container.")})},function(a){e.reject(a.data||"Error creating container.")}),e.promise},g.prototype.build=function(d){b.debug("Sending build request.");var e,f=new Tar,g=h();this.context&&(f.out=new Uint8Array(this.context.out),f.written=this.context.written),e=f.append("Dockerfile",d);var i=c.defer();return a.post(g+"/build",new Uint8Array(e),{headers:{"content-type":"application/x-tar"},transformRequest:[],transformResponse:function(a,b){var c=null;if("application/json"===b("content-type")){var d=angular.fromJson("["+a.replace(/}\r\n{/g,"},{")+"]"),e=d[d.length-1],f=null;return c={steps:d},e.error?(c.state="error",c.message=e.error):(f=/Successfully built (.*)\n/.exec(e.stream))?(c.state="success",c.imageId=f[1]):(c.state="unknown",c.message=e.stream),c}return c={state:"error",message:a}}}).then(function(a){b.debug("Build image request successful.",a);var c=a.data;"success"===c.state?i.resolve(c):i.reject(c)},function(a){b.debug("Build image request failed.",a),i.reject(a.data)}),i.promise},new g}]);var app=angular.module("dockerIde");app.config(["$stateProvider",function(a){a.state("editor",{url:"/",templateUrl:"scripts/editor/editor.html",controller:["$scope","$state","$timeout","MODE","BuildManager","TerminalManager","localStorageService",function(a,b,c,d,e,f,g){var h,i,j;"embedded"===d||g.get("dockerUrl")||b.includes("editor.settings")||b.go("editor.settings"),g.bind(a,"dockerfile"),a.$on("LocalStorageModule.notification.setitem",function(b,c){"dockerfile"===c.key&&(a.dockerfile=c.newvalue)}),a.options={lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:"dockerfile",theme:"lesser-dark",gutters:["line-status"],autoCloseBrackets:!0,onLoad:function(d){function g(a){h.on(a,function(b,d){c(function(){CodeMirror.signal(h,"cm:"+a,d)})})}h=d,g("change"),g("focus"),g("gutterClick"),h.on("cm:focus",function(){b.is("editor")||b.go("editor")}),i=new e(h),j=new f(a,h)}},a.toggleState=function(a){b.go(b.includes(a)?"editor":a)}}]})}]),app.filter("encodeURIComponent",function(){return window.encodeURIComponent}),angular.module("dockerIde").factory("BuildManager",["$log","$timeout","docker","lineStatusService",function(a,b,c,d){function e(a){this.codeMirror=a,this.codeMirror.on("cm:change",angular.bind(this,this.handleChange)),this.processChangesTimeoutId=null}function f(a,b,c){a.addLineClass(b,"text","cm-error"),a.addLineWidget(b,angular.element('<span class="cm-error">'+c+"</span>")[0])}function g(a){var b=a.text.trim();return"\\"===b.charAt(b.length-1)}return e.prototype.scheduleProcessChanges=function(){this.processChangesTimeoutId||(a.debug("Scheduling process changes"),this.processChangesTimeoutId=b(angular.bind(this,this.processChanges),500))},e.prototype.handleChange=function(b){function c(a){a.clear()}a.debug("Handling CodeMirror change event.",b);var e=this.codeMirror,f=b.from.line,h=e.lastLine(),i=e.getLineHandle(f),j=b.text.length>1||b.removed.length>1,k=/^#/.test(i.text)&&(b.from.ch>0||"#"!==b.text[0]),l=(!k||j)&&(b.text.join("").length>0||b.removed.join("").length>0);if(l){for(;f>0&&(i=e.getLineHandle(f-1),g(i));f--);for(var m=!1;h>=f;f++)i=e.getLineHandle(f),i.__continuation=m,/^$|^#/.test(i.text.trim())?i.__imageId=null:d.update(e,i,"dirty"),i.__lastChange=new Date,i.__error=null,i.widgets&&(e.removeLineClass(i,"text","cm-error"),i.widgets.forEach(c)),m=g(i);m||this.scheduleProcessChanges()}},e.prototype.buildImage=function(b,e){function g(a,b){a.forEach(function(a){d.update(i,a,b)})}a.debug("Building image.");var h=this,i=this.codeMirror,j=b[0],k="";g(b,"loading"),e&&(k="FROM "+e+"\n"),b.forEach(function(a){k+=a.text+"\n"}),c.build(k).then(function(c){a.debug("Image build successful"),g(b,"built"),j.__imageId=c.imageId,h.scheduleProcessChanges()},function(c){c?(a.debug("Image build failed. Error:",c.message),b.some(function(a){return"dirty"===a.__state})?(g(b,"dirty"),h.scheduleProcessChanges()):(g(b,"error"),f(i,b[b.length-1],c.message))):(a.debug("Docker build request failed, will retry.",c),g(b,"dirty"),h.scheduleProcessChanges())})},e.prototype.processChanges=function(){a.debug("Processing line changes."),this.processChangesTimeoutId=null;for(var b,c=this.codeMirror,d=0,e=c.lastLine(),f=[],h=null;e>=d;d++){if(a.debug("Processing line",d),b=c.getLineHandle(d),"dirty"===b.__state){if(a.debug("Line is dirty"),new Date-b.__lastChange>1e3){if(a.debug("Line is stable."),f.push(b),g(b))continue;this.buildImage(f,h)}else a.debug("Line is not stable."),this.scheduleProcessChanges();break}if("error"===b.__state)break;b.__imageId&&(h=b.__imageId)}},e}]),angular.module("dockerIde").factory("TerminalManager",["$log","lineStatusService",function(a,b){function c(a,b){this.codeMirror=b,this.codeMirror.on("cm:gutterClick",angular.bind(this,this.openTerminalForLine)),this.terminals=[],a.terminals=this.terminals,a.terminalOpened=angular.bind(this,this.terminalOpened),a.terminalClosed=angular.bind(this,this.terminalClosed)}return c.prototype.openTerminalForLine=function(a){var c,d=this.codeMirror,e=d.getLineHandle(a);this.terminals.some(function(a){return a.imageId===e.__imageId?(c=a,!0):!1}),c?c.active=!0:e.__imageId&&(this.terminals.push({line:e,imageId:e.__imageId,title:e.text,active:!0}),b.update(d,e,"loading"))},c.prototype.terminalOpened=function(a){var c=this.terminals,d=c[a].line,e=this.codeMirror;b.update(e,d,"connected")},c.prototype.terminalClosed=function(a){var c=this.terminals,d=c[a].line,e=this.codeMirror;b.update(e,d,"built"),c.splice(a,1)},c}]);var GUTTER_NAME="line-status";LineStatusService.prototype.update=function(a,b,c){function d(a){return angular.element('<i class="fa fa-fw '+a+'"></i>')[0]}function e(){a.setGutterMarker(b,GUTTER_NAME,null)}if(b.__state!==c)if(b.__state=c,b.__continuation)e();else switch(b.__state){case"loading":a.setGutterMarker(b,GUTTER_NAME,d("fa-refresh fa-spin"));break;case"built":case"connected":a.setGutterMarker(b,GUTTER_NAME,d("fa-terminal"));break;case"error":a.setGutterMarker(b,GUTTER_NAME,d("fa-circle alert"));break;default:e()}},angular.module("dockerIde").service("lineStatusService",[LineStatusService]);var Tar;Tar=require("tar-js"),angular.module("dockerIde").config(["$stateProvider",function(a){a.state("editor.directory",{url:"directory",views:{"side-bar":{templateUrl:"scripts/editor/directory/directory.html",controller:["$scope","$log","$timeout","localStorageService","docker",function(a,b,c,d,e){d.bind(a,"directory"),a.state="",a.selectDirectory=function(f){function g(a){return k.some(function(b){return b.test(a)})}function h(){f=f.filter(function(a){return a.path=a.webkitRelativePath.substring(a.webkitRelativePath.indexOf("/")+1),!g(a.path)}),function b(g){if(g===f.length)return void c(function(){a.state="success",a.directory=l,e.setContext(i)});var h=new FileReader,j=f[g];"Dockerfile"===j.path?(h.onload=function(){c(function(){d.set("dockerfile",h.result)}),b(g+1)},h.readAsText(j)):(h.onload=function(){i.append(j.path,new Uint8Array(h.result)),b(g+1)},h.readAsArrayBuffer(j))}(0)}if(0!==f.length){b.debug("Directory selected"),a.state="loading",a.directory=null;var i=new Tar,j=null,k=[],l=f[0].webkitRelativePath.substring(0,f[0].webkitRelativePath.indexOf("/"));if(f.some(function(a){return".dockerignore"===a.name?(j=a,!0):!1}),j){var m,n=new FileReader;n.onload=function(){m=n.result.split(/\n/),k=[];for(var a=0;a<m.length;a++)m[a].trim().length>0&&(k[a]=new RegExp("^"+m[a].replace(/\./g,"\\.").replace(/\*/g,".*")));h()},n.readAsText(j)}else h()}}}]}}})}]);var app=angular.module("dockerIde");app.constant("DOCKER_INSTRUCTIONS",["FROM","MAINTAINER","RUN","CMD","EXPOSE","ENV","ADD","COPY","ENTRYPOINT","VOLUME","USER","WORKDIR","ONBUILD"]),app.run(["DOCKER_INSTRUCTIONS",function(a){var b=new RegExp("(\\s*)("+a.join("|")+")(\\s|$)","i");CodeMirror.defineSimpleMode("dockerfile",{start:[{regex:b,token:[null,"instruction",null]},{regex:/"(?:[^\\]|\\.)*?"/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/#.*$/,token:"comment"},{regex:/\\(\s)*$/,indent:!0},{regex:/[^\s]+/,token:"argument"},{regex:/^\s*$/,dedent:!0}],meta:{lineComment:"#"}}),CodeMirror.defineMIME("text/x-dockerfile","dockerfile")
}]),angular.module("dockerIde").run(["DOCKER_INSTRUCTIONS",function(a){function b(b,c){if(c.length)return null;for(var d=new RegExp("^"+b.string,"i"),e=a.filter(function(a){return d.test(a)}),f=b.string.charAt(0)===b.string.charAt(0).toUpperCase(),g=0;g<e.length;g++)e[g]=f?e[g].toUpperCase():e[g].toLowerCase();return e}function c(a){var c=a.getCursor(),d=a.getTokenAt(c);d.state=CodeMirror.innerMode(a.getMode(),d.state).state,d.end>c.ch&&(d.end=c.ch,d.string=d.string.slice(0,c.ch-d.start));for(var e=d,f=[];e&&"argument"===e.type;)e=a.getTokenAt(CodeMirror.Pos(c.line,e.start)),e&&e.type&&f.push(e);return{list:b(d,f),from:CodeMirror.Pos(c.line,d.start),to:CodeMirror.Pos(c.line,d.end)}}CodeMirror.registerHelper("hint","dockerfile",c)}]);var app=angular.module("dockerIde");app.config(["$stateProvider",function(a){a.state("editor.settings",{url:"settings",views:{"side-bar":{templateUrl:"scripts/editor/settings/settings.html",controller:["$scope","localStorageService","docker",function(a,b,c){b.bind(a,"dockerUrl"),a.state="",a.testConnection=function(){return a.dockerUrl?(a.state="loading",void c.ping().then(function(){a.state="success"},function(){a.state="failure"})):void(a.state="")},a.$watch("dockerUrl",function(){a.testConnection()})}]}}})}]);var app=angular.module("dockerIde");app.directive("terminal",["$log","docker",function(a,b){function c(c,d){var e,f=new Terminal({cols:80,rows:24});f.open(d.get(0)),f.on("data",function(a){e&&e.send(a)}),c.$on("socket:open",function(){c.open&&c.open(),f.focus()}),c.$on("socket:data",function(a,b){f.write(b)}),c.$on("socket:error",function(b){a.debug("Error:",b)}),c.$on("socket:close",function(){c.close&&c.close(),e=null,f.reset()}),b.connect(c.imageId).then(function(a){e=a,e.onopen=function(){c.$apply(function(){c.$broadcast("socket:open")})},e.onclose=function(){c.$apply(function(){c.$broadcast("socket:close")})},e.onmessage=function(a){c.$apply(function(){c.$broadcast("socket:data",a.data)})},e.onerror=function(a){c.$apply(function(){c.$broadcast("socket:error",a)})}},function(b){a.debug("Error creating container.",b)})}return{restrict:"E",replace:!0,scope:{imageId:"=",open:"&onOpen",close:"&onClose"},templateUrl:"scripts/terminal/terminal.html",link:c}}]);